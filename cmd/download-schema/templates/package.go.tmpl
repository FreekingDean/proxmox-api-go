// File generated by proxmox json schema, DO NOT EDIT

package {{.Name}}

import (
  "context"
	{{- if .ImportURL }}
	"net/url"

	{{- end -}}
  {{- if .Util }}
  "github.com/FreekingDean/proxmox-api-go/internal/util"
  {{ end }}
)

type HTTPClient interface {
	Do(context.Context, string, string, interface{}, interface{}) error
}

type Client struct {
	httpClient HTTPClient
}

func New(c HTTPClient) *Client {
	return &Client{
		httpClient: c,
	}
}

{{- define "type" -}}
{{- if eq .Type "struct" -}}
{{- if or .Properties .OptionalProperties -}}
struct {
{{- range $_, $prop := .Properties }}
  {{$prop.Name}} {{template "type" $prop}} `url:"{{$prop.JSONName}}" json:"{{$prop.JSONName}}"` {{ if $prop.Description }}// {{ $prop.Description }}{{ end }}
{{- end}}
{{ if .OptionalProperties }}
// The following parameters are optional
{{- range $_, $prop := .OptionalProperties }}
  {{$prop.Name}} {{template "type" $prop}} `url:"{{$prop.JSONName}},omitempty" json:"{{$prop.JSONName}},omitempty"` {{ if $prop.Description }}// {{ $prop.Description }}{{ end }}
{{- end}}
{{- end }}
}
{{- else -}}
map[string]interface{}
{{- end}}
{{- else -}}
{{.Type}}
{{- end}}
{{- end}}

{{ define "operation" }}

// {{.Operation}} {{.Description}}
func (c *Client) {{.Operation}}(ctx context.Context
{{- if .Request}}, req {{.Request.Type}}{{end -}}
  ) ({{ if .Response -}}{{.Response.Type}}, {{ end }}error) {
  {{ if .Response -}}
	var resp {{.Response.Type}}
  {{ end }}
  err := c.httpClient.Do(ctx, "{{.Path}}", "{{.Method}}", {{ if .Response }}&resp{{ else }}nil{{ end }}, {{if .Request}}req{{else}}nil{{end}})
  return {{ if .Response }}resp, {{ end }}err
}
{{ end }}


{{ range $t := .Types }}
{{ if $t.Description }}
// {{ $t.Description }}
{{ end -}}
type {{ $t.Name }} {{ template "type" $t }}
{{ if ne $t.Format ""}}
{{ if eq $t.Format "array" }}
func (t {{ $t.Name }}) EncodeValues(key string, v *url.Values) error {
	return util.EncodeArray(key, v, t)
}
{{ else }}
func (t {{ $t.Name }}) EncodeValues(key string, v *url.Values) error {
	return util.EncodeString(key, v, t, `{{ $t.Format }}`)
}
{{ end }}
{{ end }}
{{ end }}

{{ range $_, $method := .Methods }}
{{ template "operation" $method }}
{{ end }}
